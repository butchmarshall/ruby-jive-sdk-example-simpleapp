!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.jQuery.Api=t(e.jquery)}(this,function(e){return function(e){"use strict";e(window.jQuery)}(function(e){"use strict";function t(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}function n(t){return e.Request(t).then(function(e){return e.response?e.response:e})}function r(n,r){if(r="object"!=typeof r?{}:r,t(r)){var o=e(":focus"),i=e(r);i.wrap("<form></form>");var a=i.parent();r=a.serializeObject(),i.unwrap(),o.focus()}var s=n.indexOf("?")>-1?"&":"?",u=e.param(r);return n+(u.length>0?s+e.param(r):"")}function o(t,n){if(e.isArray(n))for(var o,i=0;(o=t.match(/{[^}]+}/))&&(t=t.replace(/{[^}]+}/,n[i]),i++,n[i]););else for(var a in n)t=t.replace("{"+a+"}",n[a]);var s=u.extraParams;return r(t,s)}function i(e,t){return t.links&&(t.links.next&&(t.next=a(e,t.links.next.href)),t.links.previous&&(t.previous=a(e,t.links.previous.href))),t}function a(e,t){return function(){t.match(/^http[s]?:/i)||(t=u.baseUrl?u.baseUrl()+t:window.location.protocol+"//"+window.location.host+t);var o=r(t,{});return c[e]||(c[e]={}),c[e][o]||(c[e][o]=n({url:t,type:"GET",dataType:f[e].dataType})),c[e][o].promise().then(function(t){return i(e,t)})}}function s(t,a,s,l){var d=a,y=f[t],h=null,m="boolean"==typeof l?l:l.no_cache;if(l="object"!=typeof l?{}:l,"string"==typeof d){var g,b={},v=e.Request.parseUri(d),w=y.endpoint.split(/\//),x=v.path.split(/\//);if(w.length==x.length)for(var j=0;j<w.length;j++)if(g=w[j].match(/^{([^}]+)}$/))b[g[1]]=x[j];else if(w[j]!=x[j]){h=d;break}d=b,v.query.length>0&&(s="object"!=typeof s?{}:s,s=e.extend(s,e.deparam(v.query))),h&&(h=r(h,u.extraParams))}h||(h=o(y.endpoint,d)),h.match(/^http[s]?:/i)||(h=u.baseUrl?u.baseUrl()+h:window.location.protocol+"//"+window.location.host+h);var T="GET"==y.type?r(h,s):h;if(e.isArray(d)){for(var _,q={},g=y.endpoint.match(/{[^}]+}/g),j=0;j<g.length;j++)_=g[j].replace(/^{/,"").replace(/}$/,""),d[j]&&(q[_]=d[j]);d=q}return c[t]||(c[t]={}),s=y.before_send(s),(!c[t][T]||m)&&(c[t][T]=n(e.extend({},l,y,{url:h,data:s,dataType:p}))),function(e,n){c[t][n].promise().then(function(t){e.success({response:t,route:e,request_cache:c,no_cache:m})},function(r){e.failure(r),delete c[t][n]})}(y,T),"GET"!=y.type&&!function(e){c[t][e].promise().then(function(){c[t][e]=null})}(T),c[t][T].promise().then(function(e){return y.filter_response?y.filter_response(e,d,a,s).then(function(e){return i(t,e)}):i(t,e)})}var u={};u.baseUrl=function(){return u.domain},u.extraParams={},u.domain=window.location.protocol+"//"+window.location.host;var f={},c={},p="json";u.logger=function(){try{var e=Array.prototype.slice.call(arguments,0);e.shift()}catch(t){}},u.clearCache=function(e){return c[e]={},!0},u.addRoute=function(t,n,r){r="object"!=typeof r?{}:r,r.endpoint=n,r.type="string"!=typeof r.type?"GET":r.type.toUpperCase(),r.dataType="string"!=typeof r.dataType?p:r.dataType,r.success="function"!=typeof r.success?function(){}:r.success,r.failure="function"!=typeof r.failure?function(){}:r.failure,r.before_send="function"!=typeof r.before_send?function(e){return e}:r.before_send,r.filter_response="function"!=typeof r.filter_response?function(t){return e.Deferred().resolve(t)}:r.filter_response,r.cors="boolean"!=typeof r.cors?!0:r.cors,r.processData="boolean"!=typeof r.processData?!0:r.processData,f[t]&&u.logger("warn","Overwriting already defined route",t),f[t]=e.extend({},r)},u.execute=function(e,t,n,r){return f[e]?s(e,t,n,r):(u.logger("error","Could not execute undefined route",e),!1)},u.url=function(t,n,i){if(!f[t])return u.logger("error","Could not execute undefined route",t),!1;var a=f[t],s=null;if("string"==typeof n){var c,p={},l=e.Request.parseUri(n),d=a.endpoint.split(/\//),y=l.path.split(/\//);if(d.length==y.length)for(var h=0;h<d.length;h++)if(c=d[h].match(/^{([^}]+)}$/))p[c[1]]=y[h];else if(d[h]!=y[h]){s=n;break}n=p,l.query.length>0&&(i="object"!=typeof i?{}:i,i=e.extend(i,e.deparam(l.query))),s&&(s=r(s,u.extraParams))}return s||(s=o(a.endpoint,n)),s.match(/^http[s]?:/i)||(s=u.baseUrl?u.baseUrl()+s:window.location.protocol+"//"+window.location.host+s),"GET"!=a.type&&(s=r(s,{_method:a.type})),"undefined"!=typeof i&&(s=r(s,i)),s},e.Api=u}),jQuery.Api});